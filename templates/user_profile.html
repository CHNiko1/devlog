{% extends "base.html" %}

{% block title %}{{ user.username }} - DevLog{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- User Profile Header -->
    <div class="card mb-5">
        <div class="card-body">
            <div class="row align-items-center">
                <!-- Profile Photo -->
                <div class="col-md-3 text-center mb-3 mb-md-0 position-relative">
                    <img src="{{ user.profile_photo }}" alt="{{ user.username }}" class="rounded-circle" width="150" height="150" style="object-fit: cover; border: 3px solid #667eea;">
                    
                    <!-- Photo Upload for Own Profile -->
                    {% if current_user and current_user.id == user.id %}
                        <form method="POST" action="{{ url_for('upload_photo') }}" enctype="multipart/form-data" class="mt-3">
                            <input type="file" name="photo" class="form-control form-control-sm" accept="image/*" id="photoInput" onchange="this.form.submit()">
                            <label for="photoInput" class="btn btn-sm btn-outline-primary mt-2">
                                ğŸ“· áƒ¤áƒáƒ¢áƒ áƒ¨áƒ”áƒªáƒ•áƒšáƒ
                            </label>
                        </form>
                    {% endif %}
                </div>
                
                <!-- User Info -->
                <div class="col-md-9">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h1 class="mb-2">{{ user.username }}</h1>
                            <div class="mb-2">
                                <span class="badge badge-level">
                                    {% if user.level == 'beginner' %}ğŸŸ¢ áƒ¡áƒ¢áƒáƒŸáƒ˜áƒáƒ áƒ˜ / Trainee
                                    {% elif user.level == 'junior' %}ğŸ”µ áƒ¯áƒ£áƒœáƒ˜áƒáƒ áƒ˜ / Junior
                                    {% elif user.level == 'intermediate' %}ğŸŸ  áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ / Mid-Level
                                    {% else %}ğŸ”´ áƒ¡áƒ”áƒœáƒ˜áƒáƒ áƒ˜ / Senior
                                    {% endif %}
                                </span>
                            </div>
                            
                            <!-- Edit Level Button (Only for own profile) -->
                            {% if current_user and current_user.id == user.id %}
                                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#editLevelForm" aria-expanded="false" aria-controls="editLevelForm">
                                    âœï¸ áƒ“áƒáƒœáƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ•áƒšáƒ
                                </button>
                                
                                <div class="collapse mt-2" id="editLevelForm">
                                    <form method="POST" action="{{ url_for('update_level') }}" class="card card-body">
                                        <div class="mb-2">
                                            <label for="levelSelect" class="form-label">áƒáƒ áƒáƒ’áƒ áƒáƒ›áƒ˜áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒœáƒ”</label>
                                            <select class="form-select form-select-sm" id="levelSelect" name="level" required>
                                                <option value="beginner" {% if user.level == 'beginner' %}selected{% endif %}>ğŸŸ¢ áƒ¡áƒ¢áƒáƒŸáƒ˜áƒáƒ áƒ˜ / Trainee</option>
                                                <option value="junior" {% if user.level == 'junior' %}selected{% endif %}>ğŸ”µ áƒ¯áƒ£áƒœáƒ˜áƒáƒ áƒ˜ / Junior</option>
                                                <option value="intermediate" {% if user.level == 'intermediate' %}selected{% endif %}>ğŸŸ  áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ / Mid-Level</option>
                                                <option value="senior" {% if user.level == 'senior' %}selected{% endif %}>ğŸ”´ áƒ¡áƒ”áƒœáƒ˜áƒáƒ áƒ˜ / Senior</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-sm">áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
                                    </form>
                                </div>
                            {% endif %}
                            
                            <p class="text-muted mb-3">ğŸ“§ {{ user.email }}</p>
                        </div>
                        
                        <!-- Follow/Unfollow Button -->
                        {% if current_user and current_user.id != user.id %}
                            {% if is_following %}
                                <form method="POST" action="{{ url_for('unfollow_user', username=user.username) }}" style="display: inline;">
                                    <button type="submit" class="btn btn-danger btn-sm">âœ“ Unfollow</button>
                                </form>
                            {% else %}
                                <form method="POST" action="{{ url_for('follow_user', username=user.username) }}" style="display: inline;">
                                    <button type="submit" class="btn btn-primary btn-sm">+ Follow</button>
                                </form>
                            {% endif %}
                            {% if is_mutual_follow %}
                                <a href="{{ url_for('message_thread', username=user.username) }}" class="btn btn-outline-secondary btn-sm ms-2">âœ‰ï¸ áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ</a>
                            {% endif %}
                        {% endif %}
                    </div>
                    
                    <!-- Bio -->
                    <div class="bio-section mb-3">
                        {% if current_user and current_user.id == user.id %}
                            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#editBioForm" aria-expanded="false" aria-controls="editBioForm">
                                âœï¸ áƒ‘áƒ˜áƒáƒ’áƒ áƒáƒ¤áƒ˜áƒ˜áƒ¡ áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ
                            </button>
                            
                            <div class="collapse mt-2" id="editBioForm">
                                <form method="POST" action="{{ url_for('update_bio') }}" class="card card-body">
                                    <textarea name="bio" class="form-control mb-2" rows="3" placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ¨áƒ”áƒœáƒ˜ áƒ‘áƒ˜áƒ..." maxlength="500">{{ user.bio }}</textarea>
                                    <small class="text-muted d-block mb-2">áƒ›áƒáƒ¥áƒ¡áƒ˜áƒ›áƒ£áƒ› 500 áƒ¡áƒ˜áƒ›áƒ‘áƒáƒšáƒ</small>
                                    <button type="submit" class="btn btn-primary btn-sm">áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
                                </form>
                            </div>
                        {% endif %}
                        
                        {% if user.bio %}
                            <p class="lead mb-3 mt-3">{{ user.bio }}</p>
                        {% else %}
                            <p class="text-muted mb-3 mt-3">bio does not exist / áƒ‘áƒ˜áƒ áƒáƒ  áƒáƒ áƒ¡áƒ”áƒ‘áƒáƒ‘áƒ¡.</p>
                        {% endif %}
                    </div>
                    
                    <!-- Stats -->
                    <div class="row g-3 mb-3">
                        <div class="col-auto">
                            <div class="text-center">
                                <h5 class="mb-0">{{ posts|length }}</h5>
                                <small class="text-muted">Post</small>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="text-center">
                                <h5 class="mb-0">{{ reposts|length }}</h5>
                                <small class="text-muted">Repost</small>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="text-center">
                                <a href="{{ url_for('view_followers', username=user.username) }}" class="text-decoration-none">
                                    <h5 class="mb-0">{{ user.followers|length }}</h5>
                                    <small class="text-muted">Followers</small>
                                </a>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="text-center">
                                <a href="{{ url_for('view_following', username=user.username) }}" class="text-decoration-none">
                                    <h5 class="mb-0">{{ user.following|length }}</h5>
                                    <small class="text-muted">Following</small>
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Member Since -->
                    <small class="text-muted">ğŸ“… áƒ’áƒáƒ¬áƒ”áƒ•áƒ áƒ˜áƒáƒœáƒ”áƒ‘áƒ£áƒšáƒ˜: {{ user.created_at.strftime('%d.%m.%Y') }}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs for Posts and Reposts -->
    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="posts-tab" data-bs-toggle="tab" data-bs-target="#posts-content" type="button" role="tab" aria-controls="posts-content" aria-selected="true">
                ğŸ“ {{ posts|length }} áƒáƒáƒ¡áƒ¢áƒ˜
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="reposts-tab" data-bs-toggle="tab" data-bs-target="#reposts-content" type="button" role="tab" aria-controls="reposts-content" aria-selected="false">
                ğŸ”„ {{ reposts|length }} áƒ áƒ”áƒáƒáƒ¡áƒ¢áƒ˜
            </button>
        </li>
    </ul>    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Posts Tab -->
        <div class="tab-pane fade show active" id="posts-content" role="tabpanel" aria-labelledby="posts-tab">
            {% if posts %}
                <div class="row g-4">
                    {% for post in posts %}
                        <div class="col-12">
                            <div class="card post-card">
                                {% if post.photo %}
                                <img src="{{ url_for('static', filename='uploads/posts/' + post.photo) }}" class="card-img-top" alt="{{ post.title }}" style="max-height: 200px; object-fit: cover;">
                                {% endif %}
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h5 class="card-title mb-0">
                                            <a href="{{ url_for('post_detail', post_id=post.id) }}" class="text-decoration-none">{{ post.title }}</a>
                                        </h5>
                                        {% if not post.is_published %}
                                            <span class="badge bg-warning">â³ áƒ›áƒáƒšáƒáƒ“áƒ˜áƒœáƒ¨áƒ˜áƒ</span>
                                        {% endif %}
                                    </div>
                                    <div class="mb-3">
                                        <span class="badge badge-language">{{ post.language }}</span>
                                        <span class="badge badge-level">
                                            {% if post.level == 'beginner' %}ğŸŸ¢ áƒ¡áƒ¢áƒáƒŸáƒ˜áƒáƒ áƒ˜ / Trainee
                                            {% elif post.level == 'junior' %}ğŸ”µ áƒ¯áƒ£áƒœáƒ˜áƒáƒ áƒ˜ / Junior
                                            {% elif post.level == 'intermediate' %}ğŸŸ  áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ / Mid-Level
                                            {% else %}ğŸ”´ áƒ¡áƒ”áƒœáƒ˜áƒáƒ áƒ˜ / Senior
                                            {% endif %}
                                        </span>
                                    </div>
                                    <p class="card-text text-muted">
                                        {{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}
                                    </p>
                                    <div class="d-flex justify-content-between align-items-center small text-muted">
                                        <span>ğŸ“… {{ post.created_at.strftime('%d.%m.%Y') }}</span>
                                        <a href="{{ url_for('post_detail', post_id=post.id) }}" class="btn btn-sm btn-outline-primary">áƒ¬áƒáƒ™áƒ˜áƒ—áƒ®áƒ•áƒ</a>
                                        {% if current_user and (current_user.id == post.author_id or current_user.role == 'admin') %}
                                        <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" style="display:inline;" onsubmit="return confirm('áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ®áƒáƒ  áƒ áƒáƒ› áƒ’áƒ˜áƒœáƒ“áƒ áƒáƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?');">
                                            <button type="submit" class="btn btn-sm btn-danger ms-2">ğŸ—‘ï¸ áƒ¬áƒáƒ¨áƒšáƒ</button>
                                        </form>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info" role="alert">
                    <strong>ğŸš€ áƒáƒáƒ¡áƒ¢áƒ˜ áƒ¯áƒ”áƒ  áƒáƒ  áƒáƒ¥áƒ•áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜áƒšáƒ˜</strong>
                </div>
            {% endif %}
        </div>

        <!-- Reposts Tab -->
        <div class="tab-pane fade" id="reposts-content" role="tabpanel" aria-labelledby="reposts-tab">
            {% if reposts %}
                <div class="row g-4">
                    {% for post in reposts %}
                        <div class="col-12">
                            <div class="card post-card">
                                <div class="card-header bg-light">
                                    <small class="text-muted">ğŸ”„ {{ user.username }}-áƒ˜áƒ¡ áƒ›áƒ˜áƒ”áƒ  áƒ áƒ”áƒáƒáƒ¡áƒ¢áƒ˜</small>
                                </div>
                                {% if post.photo %}
                                <img src="{{ url_for('static', filename='uploads/posts/' + post.photo) }}" class="card-img-top" alt="{{ post.title }}" style="max-height: 200px; object-fit: cover;">
                                {% endif %}
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h5 class="card-title mb-0">
                                            <a href="{{ url_for('post_detail', post_id=post.id) }}" class="text-decoration-none">{{ post.title }}</a>
                                        </h5>
                                    </div>
                                    <div class="mb-3">
                                        <span class="badge badge-language">{{ post.language }}</span>
                                        <span class="badge badge-level">
                                            {% if post.level == 'beginner' %}ğŸŸ¢ áƒ¡áƒ¢áƒáƒŸáƒ˜áƒáƒ áƒ˜ / Trainee
                                            {% elif post.level == 'junior' %}ğŸ”µ áƒ¯áƒ£áƒœáƒ˜áƒáƒ áƒ˜ / Junior
                                            {% elif post.level == 'intermediate' %}ğŸŸ  áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ / Mid-Level
                                            {% else %}ğŸ”´ áƒ¡áƒ”áƒœáƒ˜áƒáƒ áƒ˜ / Senior
                                            {% endif %}
                                        </span>
                                    </div>
                                    <p class="card-text text-muted mb-2">
                                        {{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}
                                    </p>
                                    <small class="text-muted d-block mb-3">ğŸ‘¤ áƒáƒ•áƒ¢áƒáƒ áƒ˜: <a href="{{ url_for('user_profile', username=post.author.username) }}" class="text-decoration-none">{{ post.author.username }}</a></small>
                                    <div class="d-flex justify-content-between align-items-center small text-muted">
                                        <span>ğŸ“… {{ post.created_at.strftime('%d.%m.%Y') }}</span>
                                        <a href="{{ url_for('post_detail', post_id=post.id) }}" class="btn btn-sm btn-outline-primary">áƒ¬áƒáƒ™áƒ˜áƒ—áƒ®áƒ•áƒ</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info" role="alert">
                    <strong>ğŸš€ áƒ áƒ”áƒáƒáƒ¡áƒ¢áƒ˜ áƒ¯áƒ”áƒ  áƒáƒ  áƒáƒ¥áƒ•áƒ¡</strong>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% extends "base.html" %}

{% block title %}{{ post.title }} â€” DevLog{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Main Content -->
        <div class="col-md-8">
            <!-- Post Header -->
            <article class="mb-4">
                <header class="mb-4">
                    <h1 class="display-4 mb-3">{{ post.title }}</h1>
                    <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
                        <span class="badge badge-language">{{ post.language }}</span>
                        <span class="badge badge-level">
                            {% if post.level == 'beginner' %}ğŸŸ¢ áƒ¡áƒ¢áƒáƒŸáƒ˜áƒáƒ áƒ˜ / Trainee
                            {% elif post.level == 'junior' %}ğŸ”µ áƒ¯áƒ£áƒœáƒ˜áƒáƒ áƒ˜ / Junior
                            {% elif post.level == 'intermediate' %}ğŸŸ  áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ / Mid-Level
                            {% else %}ğŸ”´ áƒ¡áƒ”áƒœáƒ˜áƒáƒ áƒ˜ / Senior 
                            {% endif %}
                        </span>
                        {% if not post.is_published %}
                            <span class="badge bg-warning">â³ áƒ“áƒáƒ”áƒšáƒáƒ“áƒ”áƒ— áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ¡ áƒ áƒáƒ—áƒ áƒ“áƒáƒáƒ“áƒáƒ¡áƒ¢áƒ£áƒ áƒáƒ¡ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒáƒ¡áƒ¢áƒ˜</span>
                        {% endif %}
                    </div>
                    <div class="text-muted small">
                        <p class="mb-0">
                            <a href="{{ url_for('user_profile', username=post.author.username) }}" class="text-decoration-none text-muted"><strong>ğŸ‘¤ {{ post.author.username }}</strong></a> | 
                            <span title="{{ post.created_at.strftime('%d.%m.%Y %H:%M') if post.created_at else 'áƒ£áƒªáƒœáƒáƒ‘áƒ˜' }}">
                                ğŸ“… {{ post.created_at.strftime('%d.%m.%Y') if post.created_at else 'áƒ£áƒªáƒœáƒáƒ‘áƒ˜' }}
                            </span>
                        </p>
                    </div>
                </header>

                <!-- Post Content -->
                <section class="post-content">
                    {{ post.content }}
                </section>

                <!-- Delete Post Button (Author or Admin) -->
                {% if current_user.is_authenticated and (current_user.id == post.author_id or current_user.role == 'admin') %}
                <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" onsubmit="return confirm('áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ®áƒáƒ  áƒ áƒáƒ› áƒ’áƒ˜áƒœáƒ“áƒ áƒáƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?');" class="mt-4">
                    <button type="submit" class="btn btn-danger">ğŸ—‘ï¸ áƒáƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ</button>
                </form>
                {% endif %}

                <!-- Like and Repost Actions -->
                <div class="post-actions mt-4 mb-4">
                    <div class="d-flex gap-2 flex-wrap">
                        <!-- Like Button -->
                        {% if current_user.is_authenticated %}
                            {% set user_liked = post.likes|selectattr('author_id', 'equalto', current_user.id)|list|length > 0 %}
                            <form method="POST" action="{{ url_for('like_post', post_id=post.id) }}" style="display: inline;">
                                <button type="submit" class="btn {% if user_liked %}btn-danger{% else %}btn-outline-danger{% endif %} btn-sm">
                                    {% if user_liked %}â¤ï¸ áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ£áƒšáƒ˜{% else %}ğŸ¤ áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ{% endif %}
                                </button>
                            </form>
                        {% else %}
                            <a href="{{ url_for('login') }}" class="btn btn-outline-danger btn-sm">ğŸ¤ áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ</a>
                        {% endif %}
                        <span class="badge bg-light text-dark align-self-center">{{ post.likes|length }}</span>

                        <!-- Repost Button -->
                        {% if current_user.is_authenticated %}
                            {% set user_reposted = post.reposts|selectattr('author_id', 'equalto', current_user.id)|list|length > 0 %}
                            <form method="POST" action="{{ url_for('repost_post', post_id=post.id) }}" style="display: inline;">
                                <button type="submit" class="btn {% if user_reposted %}btn-info{% else %}btn-outline-info{% endif %} btn-sm">
                                    {% if user_reposted %}ğŸ”„ áƒ“áƒáƒ áƒ”áƒáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ{% else %}ğŸ”„ áƒ áƒ”áƒáƒáƒ¡áƒ¢áƒ˜{% endif %}
                                </button>
                            </form>
                        {% else %}
                            <a href="{{ url_for('login') }}" class="btn btn-outline-info btn-sm">ğŸ”„ áƒ áƒ”áƒáƒáƒ¡áƒ¢áƒ˜</a>
                        {% endif %}
                        <span class="badge bg-light text-dark align-self-center">{{ post.reposts|length }}</span>
                    </div>
                </div>
            </article>

            <hr class="my-5">

            <!-- Comments Section -->
            <section class="comments-section">
                <h3 class="mb-4">
                    ğŸ’¬ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ”áƒ‘áƒ˜
                    {% if post.comments %}
                        <span class="badge bg-secondary">{{ post.comments|length }}</span>
                    {% endif %}
                </h3>

                <!-- Comments List -->
                {% if post.comments %}
                    <div class="comments-list mb-4">
                        {% for comment in post.comments %}
                            <div class="comment-card mb-3">
                                <div class="comment-header d-flex justify-content-between align-items-start">
                                    <div>
                                        <a href="{{ url_for('user_profile', username=comment.author.username) }}" class="text-decoration-none"><strong>ğŸ‘¤ {{ comment.author.username }}</strong></a>
                                    </div>
                                    <small class="text-muted">ğŸ“… {{ comment.created_at.strftime('%d.%m.%Y %H:%M') if comment.created_at else 'áƒ£áƒªáƒœáƒáƒ‘áƒ˜' }}</small>
                                </div>
                                <p class="comment-text mt-2 mb-0">{{ comment.content }}</p>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-light border mb-4">
                        <p class="mb-0">ğŸ‘» áƒáƒ› áƒáƒáƒ¡áƒ¢áƒ¡ áƒ¯áƒ”áƒ  áƒáƒ  áƒáƒ¥áƒ•áƒ¡ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜, áƒ˜áƒ§áƒáƒ•áƒ˜ áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜</p>
                    </div>
                {% endif %}

                <!-- Add Comment Form -->
                {% if current_user.is_authenticated %}
                    <div class="add-comment-section mt-4 pt-4 border-top">
                        <h5 class="mb-3">áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</h5>
                        <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}">
                            <div class="mb-3">
                                <label for="commentContent" class="form-label">áƒ¨áƒ”áƒœáƒ˜ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜</label>
                                <textarea 
                                    class="form-control" 
                                    id="commentContent" 
                                    name="content" 
                                    rows="3" 
                                    placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ¨áƒ”áƒœáƒ˜ áƒáƒ–áƒ áƒ˜..."
                                    required></textarea>
                                <small class="text-muted">áƒ˜áƒ§áƒáƒ•áƒ˜ áƒ–áƒ áƒ“áƒ˜áƒšáƒáƒ‘áƒ˜áƒáƒœáƒ˜</small>
                            </div>
                            <button type="submit" class="btn btn-primary">áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
                        </form>
                    </div>
                {% else %}
                    <div class="alert alert-info" role="alert">
                        <p class="mb-0">
                            áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ“áƒáƒ¡áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒšáƒáƒ“ 
                            <a href="{{ url_for('login') }}" class="alert-link">áƒ¨áƒ”áƒ“áƒ˜ áƒáƒœáƒ’áƒáƒ áƒ˜áƒ¨áƒ¨áƒ˜</a> áƒáƒœ 
                            <a href="{{ url_for('register') }}" class="alert-link">áƒ“áƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ“áƒ˜</a>
                        </p>
                    </div>
                {% endif %}
            </section>
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
            <!-- AI Helper Card -->
            <div class="card ai-helper-card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">ğŸ¤– AI áƒ“áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”</h5>
                </div>
                <div class="card-body">
                    <p class="small text-muted mb-3">
                        áƒ’áƒ˜áƒœáƒ“áƒ áƒ áƒáƒ› áƒ”áƒ¡ áƒáƒáƒ¡áƒ¢áƒ˜ áƒ’áƒáƒáƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒ Junior Developerebáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡?
                    </p>
                    <div class="form-check mb-3">
                        <input 
                            class="form-check-input" 
                            type="checkbox" 
                            id="aiSimplify" 
                            name="ai_simplify">
                        <label class="form-check-label" for="aiSimplify">
                            AI-áƒ› áƒ’áƒáƒ›áƒ˜áƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒáƒ¡
                        </label>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-primary w-100" onclick="handleAISimplify()">
                        âœ¨ áƒ’áƒáƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒ”áƒ‘áƒ
                    </button>
                    <small class="text-muted d-block mt-2">
                        áƒ”áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ áƒ¯áƒ”áƒ  áƒ”áƒ¥áƒ¡áƒáƒ”áƒ áƒ˜áƒ›áƒ”áƒœáƒ¢áƒáƒšáƒ£áƒ áƒ˜áƒ.
                    </small>
                </div>
            </div>

            <!-- Post Info Card -->
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">ğŸ“‹ áƒáƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒ</h5>
                </div>
                <div class="card-body">
                    <p class="small"><strong>áƒ”áƒœáƒ:</strong> {{ post.language }}</p>
                    <p class="small"><strong>áƒ“áƒáƒœáƒ”:</strong> 
                        {% if post.level == 'beginner' %}ğŸŸ¢ áƒ¡áƒ¢áƒáƒŸáƒ˜áƒáƒ áƒ˜ / Trainee
                        {% elif post.level == 'junior' %}ğŸ”µ áƒ¯áƒ£áƒœáƒ˜áƒáƒ áƒ˜ / Junior
                        {% elif post.level == 'intermediate' %}ğŸŸ  áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ / Mid-Level
                        {% else %}ğŸ”´ áƒ¡áƒ”áƒœáƒ˜áƒáƒ áƒ˜ / Senior
                        {% endif %}
                    </p>
                    <p class="small"><strong>áƒáƒ•áƒ¢áƒáƒ áƒ˜:</strong> {{ post.author.username }}</p>
                    <p class="small"><strong>áƒ“áƒáƒáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ:</strong> {{ post.created_at.strftime('%d.%m.%Y') if post.created_at else 'áƒ£áƒªáƒœáƒáƒ‘áƒ˜' }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function handleAISimplify() {
    const checkbox = document.getElementById('aiSimplify');
    if (checkbox.checked) {
        alert('AI áƒ’áƒáƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒ”áƒ‘áƒ áƒ›áƒáƒšáƒ” áƒ˜áƒ¥áƒœáƒ”áƒ‘áƒ áƒ®áƒ”áƒšáƒ›áƒ˜áƒ¡áƒáƒ¬áƒ•áƒ“áƒáƒ›áƒ˜! ğŸš€');
        // TODO: Backend integration for AI simplification
    }
}
</script>

{% endblock %}
